<main *ngIf="employee$ | async as data" class="flex flex-col items-center">
  <ng-container *ngTemplateOutlet="recursive; context: { current: data }"></ng-container>

  <ng-template #recursive let-current="current">
    <section *ngIf="current[0].descendants.length === 0; else target">
      <div class="border-t-4 border mb-8"></div>
      <div class="flex flex-wrap justify-center gap-4">
        <div *ngFor="let item of current">
          <tui-hosted-dropdown [content]="content" tuiDropdownHover>
              <button
                (click)="clickItem(item.id)"
                (mouseover)="hoverEvent(item)"
                [ngClass]="checkCurrentItemId(item)"
                class="w-80 h-16 bg-white flex justify-between py-3 px-6 pb-16 pt-4"
              >
                <div class="mr-4">
                  <div class="text-left" id="{{ 'cat-' + item.id }}">
                    <p class="font-bold">
                      {{ item.fullName }}
                    </p>
                    <p>
                      {{ item.jobTitle?.name }}
                    </p>
                  </div>
                </div>
                <tui-avatar [autoColor]="true" [rounded]="true" [text]="item.username"></tui-avatar>
              </button>
          </tui-hosted-dropdown>
        </div>
      </div>
    </section>

    <ng-template #target>
      <section class="grid grid-cols-1 justify-items-center">
        <tui-hosted-dropdown [content]="content" tuiDropdownHover>
          <button
            class="w-80 h-16 bg-white flex justify-between py-3 px-6 pb-16 pt-4 gap-4"
            [ngClass]="checkCurrentItemId(current[0])"
            (mouseover)="hoverEvent(current[0])"
          >
            <div class="mr-4 text-left">
              <p class="font-bold">
                {{ current[0].fullName }}
              </p>
              <p>
                {{ current[0].jobTitle?.name }}
              </p>
              <div class="text-blue-500 text-left">{{ current[0].title?.name }}</div>
            </div>
            <tui-avatar [autoColor]="true" [rounded]="true" [text]="current[0].username"></tui-avatar>
          </button>
        </tui-hosted-dropdown>

        <div class="border w-0 h-8 mx-auto"></div>

        <ng-container *ngTemplateOutlet="recursive; context: { current: current[0].descendants }"></ng-container>
      </section>
    </ng-template>

    <ng-template #content="polymorpheus" [polymorpheus]="orgContext">
      <ng-container *ngComponentOutlet="NodeChartComponent; injector: customInJector"></ng-container>
    </ng-template>
  </ng-template>
</main>
