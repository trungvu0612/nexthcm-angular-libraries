<tui-hosted-dropdown
  (click)="addSeatOrDropdown('dropdown')"
  *ngIf="seat.assignedUser as user; else icon"
  [(open)]="openDropdown"
  [canOpen]="(dragging$ | async) !== true"
  [class.selected]="openDropdown"
  [content]="content"
  [tuiDropdownMaxHeight]="520"
  [tuiDropdownSided]="true"
  class="bg-white border"
>
  <div class="text-xs font-semibold text-center">
    <hcm-avatar [image]="user.image" [rounded]="true" [text]="user.username" class="m-auto" size="m"></hcm-avatar>
    <div *ngIf="seat.statusOfUser as statusUser" class="py-0.5 border-t flex space-x-0.5">
      <span *ngFor="let seatStatus of statusUser" class="dot seat-status {{ seatStatus | seatUserState }}"></span>
    </div>
  </div>
  <ng-template #content>
    <article *transloco="let t" class="p-8">
      <div class="text-center">
        <hcm-avatar [image]="user.image" [rounded]="true" [text]="user.username" class="m-auto" size="xl"></hcm-avatar>
      </div>
      <div class="pb-3 border-b border-gray-300">
        <div class="flex-auto px-4 font-semibold text-center">
          <h1 class="mt-3 mb-2 text-2xl">{{ user.username }}</h1>
          <p class="text-lg text-gray-400">{{ user.birthDay ? (user.birthDay | translocoDate) : '' }}</p>
        </div>
      </div>
      <table class="mt-3">
        <tr class="block mt-2 text-left">
          <th>{{ t('status') }}:</th>
          <td>
            <div class="flex items-center space-x-1">
              <span *ngFor="let status of seat.statusOfUser" class="dot {{ status | seatUserState }}"></span>
            </div>
          </td>
        </tr>
        <tr class="block mt-2 text-left">
          <th>{{ t('organization') }}:</th>
          <td>{{ user.organization?.name }}</td>
        </tr>
        <tr class="block mt-2 text-left">
          <th>{{ t('directReport') }}:</th>
          <td>{{ user.directReport?.name }}</td>
        </tr>
        <tr class="block mt-2 text-left">
          <th>Email:</th>
          <td>{{ user.companyEmail }}</td>
        </tr>
        <tr class="block mt-2 text-left">
          <th>{{ t('phone') }}:</th>
          <td>{{ user.phone }}</td>
        </tr>
        <tr class="block mt-2 text-left">
          <th>{{ t('jobTitle') }}:</th>
          <td>{{ user.jobTitle?.name }}</td>
        </tr>
      </table>
      <div class="flex space-x-2 mt-3">
        <button (click)="deleteSeat()" *ngxPermissionsOnly="'UPDATE_SEAT'" appearance="secondary" size="m" tuiButton>
          {{ t('unAssignSeat') }}
        </button>
        <button
          *ngxPermissionsOnly="'UPDATE_EMPLOYEE'"
          [routerLink]="['/', 'admin', 'employees', user.id]"
          size="m"
          tuiButton
        >
          {{ t('detail') }}
        </button>
      </div>
    </article>
  </ng-template>
</tui-hosted-dropdown>

<ng-template #icon>
  <img (click)="addSeatOrDropdown('add', content)" class="object-contain w-full" src="assets/icons/marker.svg" />
</ng-template>
<ng-template #content let-observer>
  <hcm-base-form
    (cancel)="observer.complete()"
    (submitForm)="submitSeat(observer)"
    [fields]="fields"
    [form]="form"
    [model]="model"
    class="mt-5"
  ></hcm-base-form>
</ng-template>
