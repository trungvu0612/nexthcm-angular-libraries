<tui-combo-box
  (searchChange)="search$.next($event || '')"
  [formControl]="$any(formControl)"
  [formlyAttributes]="field"
  [identityMatcher]="matcher[to.matcherBy]"
  [stringify]="to.stringify"
  [style.maxWidth]="to.maxWidth"
  [tuiHintContent]="to.description || null"
  [tuiTextfieldCustomContent]="to.icon || null"
  [tuiTextfieldExampleText]="to.placeholder || ''"
  [tuiTextfieldLabelOutside]="to.textfieldLabelOutside"
  [tuiTextfieldSize]="to.textfieldSize"
  [valueContent]="content"
>
  {{ to.textfieldLabelOutside ? to.placeholder : to.label }}
  <span *ngIf="to.required && !to.textfieldLabelOutside" class="tui-required"></span>
  <ng-template #content let-item> {{ item[to.labelProp] }} </ng-template>
  <ng-template tuiDataList>
    <tui-data-list *ngIf="items$ | async as items; else loading">
      <button
        *ngFor="let item of items"
        [disabled]="!!item.disabled"
        [value]="to.valueProp ? item[to.valueProp] : item"
        tuiOption
      >
        <div class="flex items-center gap-2 my-1">
          <tui-avatar
            *ngIf="to.showImage"
            [avatarUrl]="item[to.imageProp] ? to.imagePath + item[to.imageProp] : null"
            [text]="item[to.labelProp]"
            class="rounded-full my-1"
          ></tui-avatar>
          <div>
            <p [class.font-semibold]="to.subLabelProp" class="text-base">{{ item[to.labelProp] }}</p>
            <p class="text-sm font-normal">{{ getSubLabel(item) }}</p>
          </div>
        </div>
      </button>
    </tui-data-list>
  </ng-template>
  <ng-template #loading>
    <tui-loader class="tui-space_vertical-4"></tui-loader>
  </ng-template>
</tui-combo-box>
