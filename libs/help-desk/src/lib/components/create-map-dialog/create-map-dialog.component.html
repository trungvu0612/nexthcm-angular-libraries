<h1 class="text-2xl text-center font-semibold pb-4">Create Map</h1>
<formly-form
  [fields]="fields"
  [form]="form"
  [model]="model"
  class="grid grid-cols-6 gap-4 sticky top-2 z-10 mb-4"
></formly-form>
<article #zone class="relative ring-4 ring-purple-700">
  <div
    (cdkDragEnded)="moveLine(index, $event.distance.y, 'row')"
    (click)="onClick('row', index)"
    *ngFor="let top of rows; index as index"
    [class.ring-2]="isClicked('row', index)"
    [style]="{ top: top + '%', transform: 'translate3d(0, -50%, 0)' }"
    cdkDrag
    cdkDragBoundary="article"
    class="line rowLine"
  >
    <div></div>
  </div>
  <div
    (cdkDragEnded)="moveLine(index, $event.distance.x, 'column')"
    (click)="onClick('column', index)"
    *ngFor="let left of columns; index as index"
    [class.ring-2]="isClicked('column', index)"
    [style]="{ left: left + '%', transform: 'translate3d(-50%, 0, 0)' }"
    cdkDrag
    cdkDragBoundary="article"
    class="line columnLine"
  >
    <div></div>
  </div>
  <ng-container *ngFor="let row of seatMap; index as y">
    <ng-container *ngFor="let seat of row; index as x">
      <button
        (cdkDragEnded)="moveSeatWithLines(x, y, $event.distance, $event)"
        (cdkDragStarted)="onDragStarted()"
        (click)="onToggleSeat(x, y, seat)"
        [class.bg-white]="seat.isSeat"
        [class.seat-focus]="isClicked('seat', x, y)"
        [style]="{
          top: seat.positionY + '%',
          left: seat.positionX + '%',
          width: (seat.scaleX || dimension[0]) + '%',
          height: (seat.scaleY || dimension[1]) + '%',
          'border-radius': model.rounded + '%',
          transform: 'translate3d(-50%, -50%, 0)'
        }"
        cdkDrag
        cdkDragBoundary="article"
        class="seat"
      >
        <tui-svg *ngIf="!seat.isSeat; else isSeat" src="tuiIconPlus"></tui-svg>
      </button>
    </ng-container>
  </ng-container>
  <button
    (cdkDragEnded)="moveSeat(index, $event.distance, $event)"
    (click)="onClick('seat', index)"
    *ngFor="let seat of seats; index as index"
    [class.seat-focus]="isClicked('seat', index)"
    [style]="{
      top: seat.positionY + '%',
      left: seat.positionX + '%',
      width: (seat.scaleX || dimension[0]) + '%',
      height: (seat.scaleY || dimension[1]) + '%',
      'border-radius': model.rounded + '%',
      transform: 'translate3d(-50%, -50%, 0)'
    }"
    cdkDrag
    cdkDragBoundary="article"
    class="seat bg-white"
  >
    <ng-container *ngTemplateOutlet="isSeat"></ng-container>
  </button>
  <ng-template #isSeat>
    <tui-svg src="tuiIconUser"></tui-svg>
  </ng-template>
  <img class="w-full h-full" src="https://i.imgur.com/LgjOMhH.png" />
</article>
<formly-form
  *ngIf="current.type === 'seat'"
  [fields]="seatFields"
  [form]="seatForm"
  [model]="seatModel"
  class="grid grid-cols-6 gap-4 sticky bottom-2 z-10 mt-4"
></formly-form>
<button (click)="submit()" [disabled]="!((model.rows && model.cols) || model.seats)" class="blue-button mt-4 mx-auto">
  Submit
</button>
