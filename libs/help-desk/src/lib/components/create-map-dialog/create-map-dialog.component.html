<h1 class="text-2xl text-center font-semibold pb-4">Create Map</h1>
<div class="sticky top-2 z-10">
  <tui-slider [formControl]="zoomControl" [max]="100" [min]="10"></tui-slider>
  <formly-form [fields]="fields" [form]="form" [model]="model" class="flex mb-4"></formly-form>
</div>
<section class="bg-gray-100 ring-4 ring-purple-700">
  <article #zone [style.width]="zoomControl.value + '%'" class="relative mx-auto">
    <div
      (cdkDragEnded)="moveLine(index, $event.distance.y, 'row')"
      (click)="onFocus('row', index)"
      *ngFor="let top of rows; index as index"
      [class.ring-2]="isFocus('row', index)"
      [style]="{ top: top + '%', transform: 'translate3d(0, -50%, 0)' }"
      cdkDrag
      cdkDragBoundary="article"
      class="line rowLine"
    >
      <div></div>
    </div>
    <div
      (cdkDragEnded)="moveLine(index, $event.distance.x, 'column')"
      (click)="onFocus('column', index)"
      *ngFor="let left of columns; index as index"
      [class.ring-2]="isFocus('column', index)"
      [style]="{ left: left + '%', transform: 'translate3d(-50%, 0, 0)' }"
      cdkDrag
      cdkDragBoundary="article"
      class="line columnLine"
    >
      <div></div>
    </div>
    <ng-container *ngFor="let row of seatMap; index as y">
      <ng-container *ngFor="let seat of row; index as x">
        <button
          (cdkDragEnded)="moveSeatWithLines(x, y, $event.distance, $event)"
          (cdkDragStarted)="onDragStarted()"
          (click)="onToggleSeat(x, y, seat)"
          [class.bg-white]="seat.isSeat"
          [class.seat-focus]="isFocus('seat', x, y)"
          [style]="{
            top: seat.positionY + '%',
            left: seat.positionX + '%',
            width: (seat.width || dimension.width) + '%',
            height: (seat.height || dimension.height) + '%',
            'border-radius': getRounded(seat.rounded) + '%',
            transform: 'translate3d(-50%, -50%, 0)'
          }"
          cdkDrag
          cdkDragBoundary="article"
          class="seat"
        >
          <tui-svg *ngIf="!seat.isSeat; else isSeat" src="tuiIconPlus"></tui-svg>
        </button>
      </ng-container>
    </ng-container>
    <button
      (cdkDragEnded)="moveSeat(index, $event.distance, $event)"
      (click)="onFocus('seat', index)"
      *ngFor="let seat of seats; index as index"
      [class.seat-focus]="isFocus('seat', index)"
      [style]="{
        top: seat.positionY + '%',
        left: seat.positionX + '%',
        width: (seat.width || dimension.width) + '%',
        height: (seat.height || dimension.height) + '%',
        'border-radius': getRounded(seat.rounded) + '%',
        transform: 'translate3d(-50%, -50%, 0)'
      }"
      cdkDrag
      cdkDragBoundary="article"
      class="seat bg-white"
    >
      <ng-container *ngTemplateOutlet="isSeat"></ng-container>
    </button>
    <ng-template #isSeat>
      <tui-svg src="tuiIconUser"></tui-svg>
    </ng-template>
    <img class="w-full" src="https://i.imgur.com/LgjOMhH.png" />
  </article>
</section>
<div
  *ngIf="current.type === 'seat'"
  [class.specific]="currentSeat.width !== undefined"
  class="flex items-center fixed bottom-3"
>
  <formly-form [fields]="seatFields" [form]="seatForm" [model]="seatModel" class="flex"></formly-form>
  <button
    (click)="onReset()"
    [disabled]="currentSeat.width === undefined"
    class="bg-white border border-red-600 rounded text-red-600 h-6 ml-4 px-2"
  >
    Reset
  </button>
</div>
<button
  (click)="submit()"
  [disabled]="!((model.rows && model.columns) || model.seats)"
  class="blue-button mt-4 mx-auto"
>
  Submit
</button>
