<main class="main-page">
  <header>
    <h1>Create Permission</h1>
  </header>
  <section class="main-section">
    <tui-stepper [(activeItemIndex)]="stepperIndex" class="flex justify-center mb-8">
      <button [state]="servicesForm.valid ? 'pass' : 'normal'" tuiStep>Service & Resource</button>
      <button [disabled]="!servicesForm.valid" [state]="policyForm.valid ? 'pass' : 'normal'" tuiStep>
        Review Policy
      </button>
      <button [disabled]="!policyForm.valid" tuiStep>Create & Finish</button>
    </tui-stepper>
    <form [class.hidden]="stepperIndex !== 0" [formGroup]="$any(servicesForm)">
      <formly-form [fields]="servicesFields" [form]="$any(servicesForm)" [model]="servicesModel"></formly-form>
    </form>
    <form [class.hidden]="stepperIndex !== 1" [formGroup]="$any(policyForm)">
      <p class="font-semibold text-xl mb-4">Review Permission</p>
      <formly-form [fields]="policyFields" [form]="$any(policyForm)" [model]="policyModel"></formly-form>
      <div class="flex">
        <span class="text-right font-semibold w-24 mr-4">Summary</span>
        <table class="flex-auto">
          <tr>
            <th>Service</th>
            <th>Resource & Actions</th>
          </tr>
          <!--                <tr *ngFor="let item of servicesModel.policyItems">-->
          <!--                  <td class="text-blue-primary">{{ item.service?.name }}</td>-->
          <!--                  <td>-->
          <!--                    <p *ngFor="let action of item.actions | keyvalue" class="capitalize">-->
          <!--                      {{ action.key }}: {{ action.value.join(', ') }}-->
          <!--                    </p>-->
          <!--                  </td>-->
          <!--                </tr>-->
        </table>
      </div>
      <p class="font-semibold mt-4 ml-28">
        Allow ({{ servicesModel.policyItems?.length }} of {{ servicesLength$ | async }} services)
      </p>
    </form>
    <div class="admin-buttons flex justify-end gap-4 mt-5">
      <button *ngIf="stepperIndex < 2" class="blue-button btn-custom btn-red" routerLink="../">Cancel</button>
      <button (click)="nextStep(1)" *ngIf="stepperIndex === 0" [disabled]="!servicesForm.valid" class="blue-button">
        Next
      </button>
      <button (click)="nextStep(-1)" *ngIf="stepperIndex === 1" class="blue-button btn-custom btn-primary">
        Previous
      </button>
      <button (click)="nextStep(1)" *ngIf="stepperIndex === 1" [disabled]="!policyForm.valid" class="blue-button">
        Create Policy
      </button>
    </div>
  </section>
</main>
