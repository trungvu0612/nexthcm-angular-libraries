<ng-container *transloco="let t">
  <hcm-page [title]="t('updatePermission')">
    <form (ngSubmit)="permission.submitPolicy()" [formGroup]="$any(policyForm)">
      <tui-stepper [(activeItemIndex)]="stepperIndex" class="flex justify-center py-6 mb-8">
        <button [disabled]="stepperIndex" state="pass" tuiStep type="button">Policy Detail</button>
        <button [state]="stepperIndex ? 'pass' : 'normal'" tuiStep type="button">Service & Resource</button>
        <button (click)="permission.updateDataTable()" [disabled]="!servicesForm.valid" tuiStep type="button">
          Review Policy
        </button>
      </tui-stepper>
      <hcm-permission-detail
        #permission
        *ngIf="refresh$ | async"
        [hidden]="stepperIndex !== 1"
        [policyForm]="policyForm"
        [policyModel]="policyModel"
        [servicesForm]="servicesForm"
        [servicesModel]="servicesModel"
      ></hcm-permission-detail>
      <div class="flex justify-end gap-4 mt-5">
        <button appearance="flat" routerLink="../../" size="m" tuiButton type="button">{{ t('cancel') }}</button>
        <button
          (click)="nextStep()"
          *ngIf="stepperIndex !== 2"
          [disabled]="!!stepperIndex && !servicesForm.valid"
          size="m"
          tuiButton
          type="button"
        >
          {{ t('next') }}
        </button>
        <button
          (click)="stepperIndex = 1"
          *ngIf="stepperIndex === 2"
          appearance="outline"
          size="m"
          tuiButton
          type="button"
        >
          {{ t('back') }}
        </button>
        <button *ngIf="stepperIndex === 2" size="m" tuiButton>{{ t('updatePermission') }}</button>
      </div>
    </form>
  </hcm-page>
</ng-container>
