<main *transloco="let t" class="min-h-screen px-8">
  <h1 class="text-center font-semibold text-primary pb-2">{{ t(title) }}</h1>
  <form [formGroup]="form" class="max-w-4xl mb-4">
    <formly-form
      [fields]="fields"
      [form]="form"
      [model]="model"
      class="grid grid-flow-col grid-rows-3 gap-x-10 gap-y-2"
    ></formly-form>
  </form>
  <tui-input-file
    [formControl]="imageControl"
    accept="image/*"
    label="{{ t('orDropItHere') }}"
    link="{{ t('chooseAnImage') }}"
  ></tui-input-file>
  <article #zone *ngIf="model.imageUrl" class="relative ring-4 ring-purple-700 my-4">
    <button
      (cdkDragEnded)="moveSeat(index, $event.distance, $event)"
      (click)="focusSeat(index)"
      *ngFor="let seat of seats; index as index"
      [class.opacity]="current === index"
      [style]="{
        top: seat.positionY + '%',
        left: seat.positionX + '%',
        width: (seat.width || dimension.width) + '%',
        height: (seat.height || dimension.height) + '%',
        'border-radius': getRounded(seat.rounded) + '%'
      }"
      cdkDrag
      cdkDragBoundary="article"
      class="absolute bg-blue-400 opacity-60"
    >
      <img class="object-contain w-full h-full" src="assets/icons/marker.svg" />
    </button>
    <img (load)="onImageLoad($event)" [src]="model.imageUrl | getFile | async" class="w-full" />
  </article>
  <form *ngIf="current !== -1" class="bg-gradient medium-buttons flex items-center gap-6 fixed bottom-3">
    <formly-form
      [fields]="seatFields"
      [form]="seatForm"
      [model]="seatModel"
      class="grid grid-cols-3 gap-x-6 flex-auto"
    ></formly-form>
    <button (click)="resetSeat()" [disabled]="seats[current].width === undefined" class="btn-blue" type="button">
      Reset
    </button>
    <button (click)="deleteSeat()" class="btn-red" type="button">
      <tui-svg src="tuiIconTrashLarge"></tui-svg>
    </button>
  </form>
  <div class="flex justify-end mt-4">
    <button (click)="cancel()" class="btn-blue">{{ t('cancel') }}</button>
    <button (click)="save()" [disabled]="!form.valid || !model.imageUrl" class="blue-button ml-8">
      {{ t('save') }}
    </button>
  </div>
</main>
