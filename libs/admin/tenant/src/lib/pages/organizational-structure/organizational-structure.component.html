<main *transloco="let t" class="main-page">
  <header>
    <h1>{{ t('organizationalStructure') }}</h1>
    <button (click)="upsertLevel(content)" tuiButton>{{ t('addOrganizationalLevel') }}</button>
  </header>
  <section class="main-section">
    <ngx-table [columns]="(columns$ | async) || []" [configuration]="configuration" [data]="(structure$ | async) || []">
      <ng-template let-row>
        <td>{{ row.orgTypeLabel }}</td>
        <td>{{ row.orgType }}</td>
        <td>{{ row.parentOrgTypeLabel?.orgTypeLabel }}</td>
        <td>{{ row.tenant?.tenantName }}</td>
        <td class="flex gap-2">
          <button
            (click)="upsertLevel(content, row)"
            appearance="flat"
            icon="tuiIconEditLarge"
            size="m"
            tuiIconButton
          ></button>
          <button
            (click)="deleteLevel(row.id)"
            appearance="flat"
            icon="tuiIconTrashLarge"
            size="m"
            tuiIconButton
          ></button>
        </td>
      </ng-template>
    </ngx-table>
  </section>
  <ng-template #content let-observer>
    <h1 class="font-semibold text-primary">{{ t(model.id ? 'editOrganizationalLevel' : 'addOrganizationalLevel') }}</h1>
    <form (ngSubmit)="submitLevel(observer)" [formGroup]="$any(form)">
      <formly-form [fields]="fields" [form]="$any(form)" [model]="model" class="formly-gap"></formly-form>
      <div class="flex justify-center gap-6 mt-8">
        <button (click)="observer.complete()" appearance="outline" tuiButton type="button">{{ t('cancel') }}</button>
        <button tuiButton>{{ t('save') }}</button>
      </div>
    </form>
  </ng-template>
</main>
